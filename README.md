# generate-jsdoc-example-tests

Generate test files from your JSDoc @example comments. See configuration details in the [vitest](#vitest) cookbook and adapt it to your favorite test runner üòä.

**It offers you the certainty that your JSDoc @example are valid.**

## Why

I love functions documented by example using JSDoc `@example` tag because it gives me context, ideas and usage hints.
But maintaining that becomes particularly hard because examples grow stale in glimpse.
Then came this idea: What if we could _test_ those examples?

**This library bridges this gap: you write your function, document it by example, you get the test for free.**

I do not aim at writing a test runner though, this is a whole area of expertise and lots of people do an incredible job at it, offering goodies like coverage and various test reporters.

**I aim at integrating with test runners.**

<details>
<summary>Prior art</summary>

- [tsdoc-testify](https://github.com/akito0107/tsdoc-testify) ‚Äì see [Thanks](#thanks)
- [jsdoc-spec](https://github.com/AT-290690/jsdoc-spec) ‚Äì both an example parser and the test runner, without the test runner goodies.

</details>

## How it works

You document your functions and methods, for coworkers or your future self, you get tests for free:

```ts
/**
 * @example
 * ```
 * import { sum } from "./sample";
 * assert.equal(sum(4, 5), 9);
 * ```
 */
export function sum(a: number, b: number) {
  return a + b;
}
```

<details>
<summary> What you see in VSCode when hovering the <code>sum</code> function </summary>

![image](https://github.com/user-attachments/assets/a1f61d56-2dc4-4185-93a4-db763b2bad56)

</details>

The library generates the following test file:

```ts
// DO NOT EDIT: Code generated by "generate-jsdoc-example-tests".
import * as assert from 'assert'
import { sum } from './sample'

test('Example 1', () => {
  assert.equal(sum(4, 5), 9)
})
```

## Installation

```sh
npm i -D generate-jsdoc-example-tests

# or directly via npx without installation:
npx generate-jsdoc-example-tests
```

## Usage

### CLI

`gen-jet`: gen = `generate` + j = `jsdoc` + e = `example` + t = `tests`.

```sh
$ npx gen-jet 'src/**'

# Usage with options:
$ npx gen-jet 'src/**' \
  --test-file-extension '.example.test' \
  --test-function-name 'it' \
  --header 'import { it, expect } from "vitest | jest | whatever"'
  --header 'import { myGlobalImport } from "~/src/index"'
  --include-example-containing expect,assert,assertStrict
```

Full CLI usage:
```sh
$ gen-jet --help
Usage:
  $ gen-jet './src/**'

Commands:
  [pattern]  Generate tests from JSDoc @example

Options:
  --test-function-name [name]             Name of test function (default: "test") (default: test)
  --test-file-extension [ext]             Test file extension (default: ".example.test") (default: .example.test)
  --header [texts]                        Header texts to include in test files, ie: --header 'import { test } from "vitest"' --header 'import ‚Ä¶' (default: )
  --include-example-containing <strings>  Only generate test files for examples including one of the given strings (default: assert,expect)
  -v, --version                           Display version number
  -h, --help                              Display this message
```

### Programmatic API

```ts
import { generateTests } from 'generate-jsdoc-example-tests'

generateTests('./src/**')
  .then(() => console.info('tests generated'))
  .catch(console.error)

generateTests('./src/**', { ...options })
  .then(() => console.info('tests generated'))
  .catch(console.error)

```

### Vitest

```ts
import { generateTests } from 'generate-jsdoc-example-tests'

generateTests('./src/**')
  .then(() => console.info('tests generated'))
  .catch(console.error)

generateTests('./src/**', {
  testFunctionName: 'it',
  headers: ['import { it, expect } from "vitest"'],
  includeExampleContaining: ['expect'],
  testFileExtension: '.generated.test', // do not provide `.ts` or `.js`
})
  .then(() => console.info('tests generated'))
  .catch(console.error)
```

Then you can write examples like this:
```ts
/**
 * @example
 * ```ts
 * import { myFn } from './my-fn'
 *
 * expect(myFn()).toBe(true)
 * ```
 */
export const myFn = () => true
```

It will the generate the following file:

```ts
import { it, expect } from 'vitest'
import { myFn } from './my-fn'

it('myFn', () => {
  expect(myFn()).toBe(true)
})
```

## Options

### Which tests are included ?

There is a `includeExampleContaining` option, defaulted to `['expect', 'assert']`.
Any `@example` content containing `expect` or `assert` will have a generated test.

If you want to omit a test, you can omit it with `@skipTest`:
```ts
/**
 * @example This one is included
 * ```ts
 * import { myFn } from './my-fn'
 * expect(myFn()).toBe(true)
 * ```
 * @example this one is omitted
 * {@skipTest}
 * ```ts
 * import { myFn } from './my-fn'
 * expect(myFn()).toBe(false)
 * ```
 */
export const myFn = () => true
```

### Does it generate JS or TS files?

The test files are generated according to their source file:
- if the source file is JS, the generated test file will be JS.
- if the source file is TS, the generated test file will be TS.

### I want to name my examples

Use the `@exampleName` inline tag:

```ts
/**
 * @example {@exampleName sum 4 and 5}
 * ```
 * import * as assert from "assert";
 * import { sum } from "./sample";
 *
 * assert.equal(sum(4, 5), 9);
 * ```
 */
export function sum() {‚Ä¶}
```

Generated test file:

```ts
import * as assert from "assert";
import { sum } from "./sample";

test("sum 4 and 5", () => {
  assert.equal(sum(4, 5), 9);
})
```

## Thanks

I based this work upon Akito Ito's awesome [tsdoc-testify](https://github.com/akito0107/tsdoc-testify) and pushed it further with options and test runner interop.

**Many MANY thanks to you [Akito Ito](https://github.com/akito0107) üôèüôè**

## License

Same as the original one:

This project is licensed under the Apache License 2.0 License - see the [LICENSE](LICENSE) file for details
